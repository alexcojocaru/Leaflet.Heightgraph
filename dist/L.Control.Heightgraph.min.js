!function(){"use strict";function t(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function e(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function i(i){for(var s=1;s<arguments.length;s++){var a=null!=arguments[s]?arguments[s]:{};s%2?e(Object(a),!0).forEach((function(e){t(i,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(a)):e(Object(a)).forEach((function(t){Object.defineProperty(i,t,Object.getOwnPropertyDescriptor(a,t))}))}return i}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,s=new Array(e);i<e;i++)s[i]=t[i];return s}function a(t,e){var i;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(i=function(t,e){if(t){if("string"==typeof t)return s(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?s(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var a=0,n=function(){};return{s:n,n:function(){return a>=t.length?{done:!0}:{done:!1,value:t[a++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o=!0,h=!1;return{s:function(){i=t[Symbol.iterator]()},n:function(){var t=i.next();return o=t.done,t},e:function(t){h=!0,r=t},f:function(){try{o||null==i.return||i.return()}finally{if(h)throw r}}}}L.Control.Heightgraph=L.Control.extend({options:{position:"bottomright",width:800,height:280,margins:{top:10,right:30,bottom:55,left:50},mappings:void 0,expand:!0,expandControls:!0,translation:{},expandCallback:void 0,xTicks:void 0,yTicks:void 0,highlightStyle:void 0,graphStyle:void 0},_defaultTranslation:{distance:"Distance",elevation:"Elevation",segment_length:"Segment length",type:"Type",legend:"Legend"},_init_options:function(){this._margin=this.options.margins,this._width=this.options.width,this._height=this.options.height,this._mappings=this.options.mappings,this._svgWidth=this._width-this._margin.left-this._margin.right,this._svgHeight=this._height-this._margin.top-this._margin.bottom,this._highlightStyle=this.options.highlightStyle||{color:"red"},this._graphStyle=this.options.graphStyle||{},this._dragCache={}},onAdd:function(t){var e=this._container=L.DomUtil.create("div","heightgraph");if(L.DomEvent.disableClickPropagation(e),this.options.expandControls){var i=this._button=L.DomUtil.create("div","heightgraph-toggle",e);L.DomUtil.create("a","heightgraph-toggle-icon",i),this._closeButton=L.DomUtil.create("a","heightgraph-close-icon",e)}return this._showState=!1,this._selectedAttributeIdx=0,this._initToggle(),this._init_options(),this._svg=d3.select(this._container).append("svg").attr("class","heightgraph-container").attr("width",this._width).attr("height",this._height).append("g").attr("transform","translate("+this._margin.left+","+this._margin.top+")"),this.options.expand&&this._expand(),e},onRemove:function(t){this._removeMarkedSegmentsOnMap(),this._container=null,this._svg=void 0},addData:function(t){this._addData(t)},_addData:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];void 0!==this._svg&&this._svg.selectAll("*").remove(),this._selectedAttributeIdx=e?this._selectedAttributeIdx:0,this._removeMarkedSegmentsOnMap(),this._resetDrag(!0),this._data=t,this._init_options(),this._prepareData(),this._calculateElevationBounds(),this._appendScales(),this._appendGrid(),0!==Object.keys(t).length&&this._createChart(this._selectedAttributeIdx),this._createSelectionBox()},resize:function(t){t.width&&(this.options.width=t.width),t.height&&(this.options.height=t.height),d3.select(this._container).selectAll("svg").attr("width",this.options.width).attr("height",this.options.height),this._addData(this._data,!0)},_initToggle:function(){L.Browser.touch?L.DomEvent.on(this._container,"click",L.DomEvent.stopPropagation):L.DomEvent.disableClickPropagation(this._container),this.options.expandControls&&(L.DomEvent.on(this._button,"click",this._expand,this),L.DomEvent.on(this._closeButton,"click",this._expand,this))},_dragHandler:function(){d3.event.preventDefault(),d3.event.stopPropagation(),this._gotDragged=!0,this._drawDragRectangle()},_drawDragRectangle:function(){if(this._dragStartCoords){var t=this._dragCurrentCoords=this._dragCache.end=d3.mouse(this._background.node()),e=Math.min(this._dragStartCoords[0],t[0]),i=Math.max(this._dragStartCoords[0],t[0]);if(this._dragRectangle||this._dragRectangleG)this._dragRectangle.attr("width",i-e).attr("x",e);else{var s=d3.select(this._container).select("svg").select("g");this._dragRectangleG=s.append("g"),this._dragRectangle=this._dragRectangleG.append("rect").attr("width",i-e).attr("height",this._svgHeight).attr("x",e).attr("class","mouse-drag").style("fill","grey").style("opacity",.5).style("pointer-events","none")}}},_resetDrag:function(t){if(this._dragRectangleG&&(this._dragRectangleG.remove(),this._dragRectangleG=null,this._dragRectangle=null,!0!==t)){var e=this._calculateFullExtent(this._areasFlattended);e&&this._map.fitBounds(e)}},_dragEndHandler:function(){if(!this._dragStartCoords||!this._gotDragged)return this._dragStartCoords=null,this._gotDragged=!1,void this._resetDrag();var t=this._findItemForX(this._dragStartCoords[0]),e=this._findItemForX(this._dragCurrentCoords[0]);this._fitSection(t,e),this._dragStartCoords=null,this._gotDragged=!1},_dragStartHandler:function(){d3.event.preventDefault(),d3.event.stopPropagation(),this._gotDragged=!1,this._dragStartCoords=this._dragCache.start=d3.mouse(this._background.node())},_calculateFullExtent:function(t){if(!t||t.length<1)return null;var e=new L.latLngBounds(t[0].latlng,t[0].latlng);return t.forEach((function(t){e.contains(t.latlng)||e.extend(t.latlng)})),e},_fitSection:function(t,e){var i,s=Math.min(t,e),a=Math.max(t,e);s!==a?i=this._calculateFullExtent(this._areasFlattended.slice(s,a+1)):this._areasFlattended.length>0&&(i=[this._areasFlattended[s].latlng,this._areasFlattended[a].latlng]),i&&this._map.fitBounds(i)},_expand:function(){!0!==this.options.expandControls&&(this._showState=!1),this._showState?(d3.select(this._button).style("display","block"),d3.select(this._container).selectAll("svg").style("display","none"),d3.select(this._closeButton).style("display","none")):(d3.select(this._button).style("display","none"),d3.select(this._container).selectAll("svg").style("display","block"),d3.select(this._closeButton).style("display","block")),this._showState=!this._showState,"function"==typeof this.options.expandCallback&&this.options.expandCallback(this._showState)},_removeChart:function(){void 0!==this._svg&&(this._svg.selectAll("path.area").remove(),this._svg.selectAll("path.border-top").remove(),this._svg.selectAll(".legend").remove(),this._svg.selectAll(".lineSelection").remove(),this._svg.selectAll(".horizontalLine").remove(),this._svg.selectAll(".horizontalLineText").remove())},_randomNumber:function(t){return Math.round(Math.random()*(t-0))},_prepareData:function(){this._coordinates=[],this._elevations=[],this._cumulatedDistances=[],this._cumulatedDistances.push(0),this._categories=[];var t,e=this._data;void 0===this._mappings&&(t=d3.scale.ordinal().range(["#7fc97f","#beaed4","#fdc086","#ffff99","#386cb0","#f0027f","#bf5b17","#666666"]));for(var i=0;i<e.length;i++){var s=0;this._categories[i]={info:{id:i,text:e[i].properties.summary},distances:[],attributes:[],geometries:[],legend:{}};var a=void 0,n=0,r={};for(a=0;a<e[i].features.length;a++){var o=void 0,h=void 0,l=void 0,c=[],d=e[i].features[a].geometry.coordinates.length,g=e[i].features[a].properties.attributeType,_=void 0,u=void 0;void 0===this._mappings?g in r?(_=g,u=r[g]):(_=g,u=t(a),r[g]=u):(_=this._mappings[e[i].properties.summary][g].text,u=this._mappings[e[i].properties.summary][g].color);var p={type:g,text:_,color:u};this._categories[i].attributes.push(p),g in this._categories[i].legend||(this._categories[i].legend[g]=p);for(var f=0;f<d;f++){h=new L.LatLng(e[i].features[a].geometry.coordinates[f][1],e[i].features[a].geometry.coordinates[f][0]),o=e[i].features[a].geometry.coordinates[f][2],f<d-1?(l=new L.LatLng(e[i].features[a].geometry.coordinates[f+1][1],e[i].features[a].geometry.coordinates[f+1][0]),s+=h.distanceTo(l)/1e3,0===i&&(this._elevations.push(o),this._coordinates.push(h),this._cumulatedDistances.push(s)),n+=1):f===d-1&&a===e[i].features.length-1&&(0===i&&(this._elevations.push(o),this._coordinates.push(l)),n+=1);var m=void 0;m=f===d-1&&a<e[i].features.length-1?this._cumulatedDistances[n]:this._cumulatedDistances[n-1],c.push({altitude:o,position:m,x:h.lng,y:h.lat,latlng:h,type:_,areaIdx:a})}this._categories[i].distances.push(s),this._categories[i].geometries.push(c)}i===e.length-1&&(this._totalDistance=s)}},_calculateElevationBounds:function(){var t=d3.max(this._elevations),e=d3.min(this._elevations),i=t-e;this._elevationBounds={min:i<10?e-10:e-.1*i,max:i<10?t+10:t+.1*i}},_showMapMarker:function(t,e,i){var s=this._map.latLngToLayerPoint(t),a=s.y-75;if(!this._mouseHeightFocus){var n=d3.select(".leaflet-overlay-pane svg").append("g");this._mouseHeightFocus=n.append("svg:line").attr("class","height-focus line").attr("x2","0").attr("y2","0").attr("x1","0").attr("y1","0"),this._mouseHeightFocusLabel=n.append("g").attr("class","height-focus label"),this._mouseHeightFocusLabelRect=this._mouseHeightFocusLabel.append("rect").attr("class","bBox"),this._mouseHeightFocusLabelTextElev=this._mouseHeightFocusLabel.append("text").attr("class","tspan"),this._mouseHeightFocusLabelTextType=this._mouseHeightFocusLabel.append("text").attr("class","tspan"),(this._pointG=n.append("g").attr("class","height-focus circle")).append("svg:circle").attr("r",5).attr("cx",0).attr("cy",0).attr("class","height-focus circle-lower")}this._mouseHeightFocusLabel.style("display","block"),this._mouseHeightFocus.attr("x1",s.x).attr("x2",s.x).attr("y1",s.y).attr("y2",a).style("display","block"),this._pointG.attr("transform","translate("+s.x+","+s.y+")").style("display","block"),this._mouseHeightFocusLabelRect.attr("x",s.x+3).attr("y",a).attr("class","bBox"),this._mouseHeightFocusLabelTextElev.attr("x",s.x+5).attr("y",a+12).text(e+" m").attr("class","tspan mouse-height-box-text"),this._mouseHeightFocusLabelTextType.attr("x",s.x+5).attr("y",a+24).text(i).attr("class","tspan mouse-height-box-text");var r=this._dynamicBoxSize("text.tspan")[1],o=""===i?18:30;d3.selectAll(".bBox").attr("width",r+10).attr("height",o)},_createChart:function(t){var e=0===this._categories.length?[]:this._categories[t].geometries;this._areasFlattended=[].concat.apply([],e);for(var i=0;i<e.length;i++)this._appendAreas(e[i],t,i);this._createFocus(),this._appendBackground(),this._createBorderTopLine(),this._createLegend(),this._createHorizontalLine()},_createFocus:function(){var t=this._elevationBounds.min;this._focus&&(this._focus.remove(),this._focusLineGroup.remove()),this._focus=this._svg.append("g").attr("class","focusbox"),this._focusRect=this._focus.append("rect").attr("x",3).attr("y",-this._y(t)).attr("display","none"),this._focusDistance=this._focus.append("text").attr("x",7).attr("y",15-this._y(t)).attr("id","heightgraph.distance").text(this._getTranslation("distance")+":"),this._focusHeight=this._focus.append("text").attr("x",7).attr("y",30-this._y(t)).attr("id","heightgraph.height").text(this._getTranslation("elevation")+":"),this._focusBlockDistance=this._focus.append("text").attr("x",7).attr("y",45-this._y(t)).attr("id","heightgraph.blockdistance").text(this._getTranslation("segment_length")+":"),this._focusType=this._focus.append("text").attr("x",7).attr("y",60-this._y(t)).attr("id","heightgraph.type").text(this._getTranslation("type")+":"),this._areaTspan=this._focusBlockDistance.append("tspan").attr("class","tspan"),this._typeTspan=this._focusType.append("tspan").attr("class","tspan");var e=this._dynamicBoxSize(".focusbox text")[0];d3.selectAll(".focusbox rect").attr("height",15*e+7.5).attr("display","block"),this._focusLineGroup=this._svg.append("g").attr("class","focusLine"),this._focusLine=this._focusLineGroup.append("line").attr("y1",0).attr("y2",this._y(this._elevationBounds.min)),this._distTspan=this._focusDistance.append("tspan").attr("class","tspan"),this._altTspan=this._focusHeight.append("tspan").attr("class","tspan")},_createHorizontalLine:function(){var t=this;this._horizontalLine=this._svg.append("line").attr("class","horizontalLine").attr("x1",0).attr("x2",this._width-this._margin.left-this._margin.right).attr("y1",this._y(this._elevationBounds.min)).attr("y2",this._y(this._elevationBounds.min)).style("stroke","black"),this._elevationValueText=this._svg.append("text").attr("class","horizontalLineText").attr("x",this._width-this._margin.left-this._margin.right-20).attr("y",this._y(this._elevationBounds.min)-10).attr("fill","black");var e=[{x:this._width-this._margin.left-this._margin.right+7,y:this._y(this._elevationBounds.min),color:"black",type:d3.svg.symbol().type("triangle-up"),angle:-90,size:100}];this._svg.selectAll(".horizontal-symbol").data(e).enter().append("path").attr("class","lineSelection").attr("d",d3.svg.symbol().type((function(t){return t.type})).size((function(t){return t.size}))).attr("transform",(function(t){return"translate("+t.x+","+t.y+") rotate("+t.angle+")"})).attr("id",(function(t){return t.id})).style("fill",(function(t){return t.color})).call(d3.behavior.drag().on("dragstart",(function(t){d3.select(this).raise().classed("active",!0),d3.select(".horizontalLine").raise().classed("active",!0)})).on("drag",(function(e){var i=t._svgHeight,s=d3.mouse(t._container)[1]-10;d3.select(this).attr("transform",(function(t){return"translate("+t.x+","+(s<0?0:s>i?i:s)+") rotate("+t.angle+")"})),d3.select(".horizontalLine").attr("y1",s<0?0:s>i?i:s).attr("y2",s<0?0:s>i?i:s),t._highlightedCoords=s>=i?[]:t._findCoordsForY(s),d3.select(".horizontalLineText").attr("y",s<=10?0:s>i?i-10:s-10).text(d3.format(".0f")(t._y.invert(s<0?0:s>i?i:s))+" m"),t._removeMarkedSegmentsOnMap(),t._markSegmentsOnMap(t._highlightedCoords)})).on("dragend",(function(e){d3.select(this).classed("active",!1),d3.select(".horizontalLine").classed("active",!1),t._removeMarkedSegmentsOnMap(),t._markSegmentsOnMap(t._highlightedCoords)})))},_markSegmentsOnMap:function(t){if(t)if(t.length>1){this._markedSegments=L.featureGroup();var e,s=a(t);try{for(s.s();!(e=s.n()).done;){var n=e.value;L.polyline(n,i(i({},this._highlightStyle),{interactive:!1})).addTo(this._markedSegments)}}catch(t){s.e(t)}finally{s.f()}this._markedSegments.addTo(this._map).bringToFront()}else this._markedSegments=L.polyline(t,this._highlightStyle).addTo(this._map)},_removeMarkedSegmentsOnMap:function(){void 0!==this._markedSegments&&this._map.removeLayer(this._markedSegments)},_appendScales:function(){var t=Boolean(this._totalDistance<=10);this._x=d3.scale.linear().range([0,this._svgWidth]),this._y=d3.scale.linear().range([this._svgHeight,0]),this._x.domain([0,this._totalDistance]),this._y.domain([this._elevationBounds.min,this._elevationBounds.max]),this._xAxis=d3.svg.axis().scale(this._x).orient("bottom"),!0===t?this._xAxis.tickFormat((function(t){return d3.format(".2f")(t)+" km"})):this._xAxis.tickFormat((function(t){return d3.format(".0f")(t)+" km"})),this._xAxis.ticks(this.options.xTicks?Math.pow(2,this.options.xTicks):Math.round(this._svgWidth/75),"s"),this._yAxis=d3.svg.axis().scale(this._y).orient("left").tickFormat((function(t){return t+" m"})),this._yAxis.ticks(this.options.yTicks?Math.pow(2,this.options.yTicks):Math.round(this._svgHeight/30),"s")},_appendBackground:function(){var t=this._background=d3.select(this._container).select("svg").select("g").append("rect").attr("width",this._svgWidth).attr("height",this._svgHeight).style("fill","none").style("stroke","none").style("pointer-events","all").on("mousemove.focusbox",this._mousemoveHandler.bind(this)).on("mouseout.focusbox",this._mouseoutHandler.bind(this));L.Browser.android?(t.on("touchstart.drag",this._dragHandler.bind(this)).on("touchstart.drag",this._dragStartHandler.bind(this)).on("touchstart.focusbox",this._mousemoveHandler.bind(this)),L.DomEvent.on(this._container,"touchend",this._dragEndHandler,this)):(t.on("mousemove.focusbox",this._mousemoveHandler.bind(this)).on("mouseout.focusbox",this._mouseoutHandler.bind(this)).on("mousedown.drag",this._dragStartHandler.bind(this)).on("mousemove.drag",this._dragHandler.bind(this)),L.DomEvent.on(this._container,"mouseup",this._dragEndHandler,this))},_appendGrid:function(){this._svg.append("g").attr("class","grid").attr("transform","translate(0,"+this._svgHeight+")").call(this._make_x_axis().tickSize(-this._svgHeight,0,0).ticks(Math.round(this._svgWidth/75)).tickFormat("")),this._svg.append("g").attr("class","grid").call(this._make_y_axis().tickSize(-this._svgWidth,0,0).ticks(Math.round(this._svgHeight/30)).tickFormat("")),this._svg.append("g").attr("transform","translate(0,"+this._svgHeight+")").attr("class","x axis").call(this._xAxis),this._svg.append("g").attr("transform","translate(-2,0)").attr("class","y axis").call(this._yAxis)},_appendAreas:function(t,e,i){var s=this._categories[e].attributes[i].color,a=this;this._area=d3.svg.area().x((function(t){var e=a._x(t.position);return t.xDiagonalCoordinate=e,e})).y0(this._svgHeight).y1((function(t){return a._y(t.altitude)})).interpolate("linear");for(var n in this._areapath=this._svg.append("path").attr("class","area"),this._areapath.datum(t).attr("d",this._area).attr("stroke",s),this._graphStyle)this._areapath.style(n,this._graphStyle[n]);this._areapath.style("fill",s).style("pointer-events","none")},_make_x_axis:function(){return d3.svg.axis().scale(this._x).orient("bottom")},_make_y_axis:function(){return d3.svg.axis().scale(this._y).orient("left")},_createSelectionBox:function(){var t=this,e=d3.select(this._container).select("svg"),i=this._width-this._margin.right,s=this._height-this._margin.bottom+this._margin.bottom/2+6,a=[{x:i-25,y:s+3,color:"#000",type:d3.svg.symbol().type("triangle-up"),id:"leftArrowSelection",angle:0},{x:i-10,y:s,color:"#000",type:d3.svg.symbol().type("triangle-up"),id:"rightArrowSelection",angle:180}],n=e.selectAll(".select-symbol").data(a);(n.remove(),n=e.selectAll(".select-symbol").data(a),t._data.length>1)&&[n.enter().append("path"),n].forEach((function(e){e.attr("class","select-symbol").attr("d",d3.svg.symbol().type((function(t){return t.type}))).attr("transform",(function(t){return"translate("+t.x+","+t.y+") rotate("+t.angle+")"})).attr("id",(function(t){return t.id})).style("fill",(function(t){return t.color})).on("mousedown",(function(e){"rightArrowSelection"===e.id&&h(),"leftArrowSelection"===e.id&&l(),t._gotDragged=!0,t._dragStartCoords=t._dragCache.start,t._dragCurrentCoords=t._dragCache.end}))}));var r=function(a){if(t._selectionText&&t._selectionText.remove(),0!==t._categories.length){var n=[{selection:t._categories[a].info.text}];t._selectionText=e.selectAll("selection_text").data(n).enter().append("text").attr("x",i-35).attr("y",s+4).text((function(t){return t.selection})).attr("class","select-info").attr("id","selectionText").attr("text-anchor","end")}},o=(this._categories.length,this._selectedAttributeIdx);r(o);var h=function(){var e=t._selectedAttributeIdx+=1;e===t._categories.length&&(t._selectedAttributeIdx=e=0),r(e),t._removeChart(),t._removeMarkedSegmentsOnMap(),t._createChart(e)},l=function(){var e=t._selectedAttributeIdx-=1;-1===e&&(t._selectedAttributeIdx=e=t._categories.length-1),r(e),t._removeChart(),t._removeMarkedSegmentsOnMap(),t._createChart(e)}},_createLegend:function(){var t=this,e=this,i=[];if(this._categories.length>0)for(var s in this._categories[this._selectedAttributeIdx].legend)i.push(this._categories[this._selectedAttributeIdx].legend[s]);var a=this._height-this._margin.bottom,n=a+this._margin.bottom/2,r=[{text:this._getTranslation("legend")}],o=this._svg.selectAll(".hlegend-hover").data(i).enter().append("g").attr("class","legend").style("display","none").attr("transform",(function(t,e){return"translate(-8,"+(14*e-28)+")"})),h=o.append("rect").attr("class","legend-rect").attr("x",15).attr("y",36).attr("width",6).attr("height",6);if(0!==Object.keys(this._graphStyle).length){for(var l in this._graphStyle)h.style(l,this._graphStyle[l]);h.style("stroke",(function(t,e){return t.color})).style("fill",(function(t,e){return t.color}))}else h.style("stroke","black").style("fill",(function(t,e){return t.color}));o.append("text").attr("class","legend-text").attr("x",30).attr("y",42).text((function(t,i){var s=t.text;return e._boxBoundY=(a-2*a/3+7)*i,s}));var c=this._svg.selectAll(".legend-hover").data(r).enter().append("g").attr("class","legend-hover");this._showLegend=!1,c.append("text").attr("x",15).attr("y",n).attr("text-anchor","start").text((function(t,e){return t.text})).on("mouseover",(function(){d3.selectAll(".legend").style("display","block")})).on("mouseleave",(function(){t._showLegend||d3.selectAll(".legend").style("display","none")})).on("click",(function(){t._showLegend=!t._showLegend}))},_dynamicBoxSize:function(t){var e=[];d3.selectAll(t).each((function(t,i){e.push(this.getBoundingClientRect().width)}));var i=d3.max(e);return[e.length,i]},_createBorderTopLine:function(){var t=this,e=this._areasFlattended,i=d3.svg.line().x((function(e){return(0,t._x)(e.position)})).y((function(e){return(0,t._y)(e.altitude)})).interpolate("basis");this._svg.append("svg:path").attr("d",i(e)).attr("class","border-top")},_mouseoutHandler:function(){for(var t=0,e=["_focusLine","_focus","_pointG","_mouseHeightFocus","_mouseHeightFocusLabel"];t<e.length;t++){var i=e[t];this[i]&&this[i].style("display","none")}},mapMouseoutHandler:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;this.mouseoutDelay&&window.clearTimeout(this.mouseoutDelay),this.mouseoutDelay=window.setTimeout((function(){t._mouseoutHandler()}),e)},mapMousemoveHandler:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=e.showMapMarker,s=void 0===i||i;if(!1!==this._areasFlattended){var n,r=null,o=2*Math.pow(100,2),h=1.1/111111,l=a(this._areasFlattended);try{for(l.s();!(n=l.n()).done;){var c=n.value,d=t.latlng.lat-c.latlng.lat,g=t.latlng.lng-c.latlng.lng;if(Math.abs(d)<h&&Math.abs(g)<h){this._internalMousemoveHandler(c,s);break}var _=Math.pow(d,2)+Math.pow(g,2);_<o&&(r=c,o=_)}}catch(t){l.e(t)}finally{l.f()}r&&this._internalMousemoveHandler(r,s)}},_mousemoveHandler:function(t,e,i){var s=d3.mouse(this._svg.node()),a=this._areasFlattended[this._findItemForX(s[0])];a&&this._internalMousemoveHandler(a)},_internalMousemoveHandler:function(t){var e,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],s=t.altitude,a=t.position,n=t.latlng,r=t.areaIdx,o=t.type,h=this._dynamicBoxSize(".focusbox text")[1]+10;e=0===r?this._categories[this._selectedAttributeIdx].distances[r]:this._categories[this._selectedAttributeIdx].distances[r]-this._categories[this._selectedAttributeIdx].distances[r-1],i&&this._showMapMarker(n,s,o),this._distTspan.text(" "+a.toFixed(1)+" km"),this._altTspan.text(" "+s+" m"),this._areaTspan.text(" "+e.toFixed(1)+" km"),this._typeTspan.text(" "+o),this._focusRect.attr("width",h),this._focusLine.style("display","block").attr("x1",this._x(a)).attr("x2",this._x(a));var l=this._x(a)-(h+5),c=this._width-this._margin.left-this._margin.right;this._x(a)+h<c&&this._focus.style("display","initial").attr("transform","translate("+this._x(a)+","+this._y(this._elevationBounds.min)+")"),this._x(a)+h>c&&this._focus.style("display","initial").attr("transform","translate("+l+","+this._y(this._elevationBounds.min)+")")},_findItemForX:function(t){var e=d3.bisector((function(t){return t.position})).left,i=this._x.invert(t);return e(this._areasFlattended,i)},_findCoordsForY:function(t){var e=this._y.invert(t);return function(t,e){for(var i=[],s=0;s<t.length;s++)t[s].altitude>=e&&i.push(s);for(var a=[],n=0,r=0;r<i.length-1;r++)i[r+1]!==i[r]+1&&(a.push(i.slice(n,r+1)),n=r+1);a.push(i.slice(n,i.length));for(var o=0;o<a.length;o++)for(var h=0;h<a[o].length;h++)a[o][h]=t[a[o][h]].latlng;return a}(this._areasFlattended,e)},_getTranslation:function(t){return this.options.translation[t]?this.options.translation[t]:this._defaultTranslation[t]?this._defaultTranslation[t]:(console.error("Unexpected error when looking up the translation for "+t),"No translation found")}}),L.control.heightgraph=function(t){return new L.Control.Heightgraph(t)}}();
